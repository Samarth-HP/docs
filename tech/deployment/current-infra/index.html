<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-tech/deployment/current-infra">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.0">
<title data-rh="true">Samarth Deployment Details | Samarth Docs</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://samarth-hp.github.io/docs/tech/deployment/current-infra"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Samarth Deployment Details | Samarth Docs"><meta data-rh="true" name="description" content="As a concrete illustration, let&#x27;s examine six servers constituting our deployment environment:"><meta data-rh="true" property="og:description" content="As a concrete illustration, let&#x27;s examine six servers constituting our deployment environment:"><link data-rh="true" rel="icon" href="/docs/img/favicon.png"><link data-rh="true" rel="canonical" href="https://samarth-hp.github.io/docs/tech/deployment/current-infra"><link data-rh="true" rel="alternate" href="https://samarth-hp.github.io/docs/tech/deployment/current-infra" hreflang="en"><link data-rh="true" rel="alternate" href="https://samarth-hp.github.io/docs/tech/deployment/current-infra" hreflang="x-default"><link rel="stylesheet" href="/docs/assets/css/styles.7f1b6f07.css">
<link rel="preload" href="/docs/assets/js/runtime~main.9fe122e4.js" as="script">
<link rel="preload" href="/docs/assets/js/main.1a4f36c3.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/docs/"><div class="navbar__logo"><img src="/docs/img/logo.png" alt="Samagra" class="themedImage_ToTc themedImage--light_HNdA"><img src="/docs/img/logo.png" alt="Samagra" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">Samagra Docs</b></a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/Samarth-HP/docs" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/">Samarth - Himachal Pradesh</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/docs/tech/">Tech</a><button aria-label="Toggle the collapsible sidebar category &#x27;Tech&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/docs/tech/system/">System Overview</a><button aria-label="Toggle the collapsible sidebar category &#x27;System Overview&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" tabindex="0" href="/docs/tech/deployment/">Deployment</a><button aria-label="Toggle the collapsible sidebar category &#x27;Deployment&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/tech/deployment/current-infra">Current Infrastructure</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/tech/deployment/db-setup">DB Setup</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/tech/deployment/docker-swarm-setup">Docker Swarm Setup</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/tech/deployment/jenkins-setup">Jenkins Setup</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/tech/deployment/vault-setup">Vault Setup</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/tech/deployment/service-onboarding">Service Onboarding</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/tech/analytics">Analytics</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/tech/monitoring">Monitoring</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/tech/crash-reporting">Crash Reporting</a></li></ul></li></ul></nav></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/docs/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/tech/"><span itemprop="name">Tech</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/tech/deployment/"><span itemprop="name">Deployment</span></a><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Current Infrastructure</span><meta itemprop="position" content="3"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Infrastructure Overview 📖</h1><p>As a concrete illustration, let&#x27;s examine six servers constituting our deployment environment:</p><table><thead><tr><th>Servers</th></tr></thead><tbody><tr><td>application</td></tr><tr><td>db1</td></tr><tr><td>db2</td></tr><tr><td>swarm-master</td></tr><tr><td>swarm-node2</td></tr><tr><td>swarm-node3</td></tr></tbody></table><h2 class="anchor anchorWithStickyNavbar_LWe7" id="request-flow">Request Flow<a href="#request-flow" class="hash-link" aria-label="Direct link to Request Flow" title="Direct link to Request Flow">​</a></h2><p><img loading="lazy" alt="How everything is connected" src="/docs/assets/images/samarth-deployment-flow.drawio-8fa3e69328e0fc4456a5f32dd6ec58a1.png" width="731" height="372" class="img_ev3q"></p><p>When a user initiates a request for a specific service, it first passes through Nginx, which functions as a reverse proxy and routes the request to the corresponding destination. If the request is successfully resolved at the application server, the application server handles the request and sends the response directly to the user.</p><p>However, if the request is directed to another service within the swarm network, it is delegated to the swarm-master node. The swarm-master node, in turn, can internally route the request to its worker node, which processes the request and returns the response to the master node. The master node then forwards the response to the application server, which ultimately delivers it back to the user.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="server-breakdown">Server Breakdown<a href="#server-breakdown" class="hash-link" aria-label="Direct link to Server Breakdown" title="Direct link to Server Breakdown">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="application-server-">Application Server 📱<a href="#application-server-" class="hash-link" aria-label="Direct link to Application Server 📱" title="Direct link to Application Server 📱">​</a></h3><blockquote><p>This is where this repo should be cloned.</p></blockquote><p><img loading="lazy" alt="Application Server visualized" src="/docs/assets/images/samarth-deployment-application.drawio-fb15d9673587d53aa385d8d51df9d545.png" width="341" height="381" class="img_ev3q"></p><p>The <strong>application</strong> server serves as the cornerstone, hosting services that need to be accessible from the external world. It achieves this by exposing specific ports for these services.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="services-deployed-on-application-server">Services deployed on <code>application</code> server<a href="#services-deployed-on-application-server" class="hash-link" aria-label="Direct link to services-deployed-on-application-server" title="Direct link to services-deployed-on-application-server">​</a></h4><h5 class="anchor anchorWithStickyNavbar_LWe7" id="docker-registry"><a href="https://docs.docker.com/registry/" target="_blank" rel="noopener noreferrer">Docker Registry</a><a href="#docker-registry" class="hash-link" aria-label="Direct link to docker-registry" title="Direct link to docker-registry">​</a></h5><p><strong>Docker Registry</strong> is a stateless, highly scalable server side application that stores and lets you distribute Docker images. We store our Samarth docker images over there.</p><p><strong>Setup Approach:</strong></p><p>We adhered to the instructions outlined in the <a href="https://docs.docker.com/registry/#basic-commands" target="_blank" rel="noopener noreferrer">Docker Registry documentation</a> for the establishment of our private registry.</p><h5 class="anchor anchorWithStickyNavbar_LWe7" id="vault"><a href="https://developer.hashicorp.com/vault" target="_blank" rel="noopener noreferrer">Vault</a><a href="#vault" class="hash-link" aria-label="Direct link to vault" title="Direct link to vault">​</a></h5><p>Our deployment is heavily dependent on <strong>Vault</strong> that is a service that manages secrets and protect sensitive data. you can think of it as a password manager. We store credentials and <code>env</code> variables over there that is needed by the <code>jenkins</code> on build or deployment.</p><p><strong>Setup Approach:</strong></p><p>Detailed instructions can be found in the <a href="/docs/tech/deployment/vault-setup">vault-setup.md</a> file, guiding the meticulous setup of Vault to support our deployment requirements.</p><h5 class="anchor anchorWithStickyNavbar_LWe7" id="minio"><a href="https://min.io/" target="_blank" rel="noopener noreferrer">Minio</a><a href="#minio" class="hash-link" aria-label="Direct link to minio" title="Direct link to minio">​</a></h5><p><strong>Minio</strong> is a high performance
object storage like S3 but cab be self-hosted. We use minio for storing and sharing files to the end user.
In this deployment context, we use minio with <code>doc-generator</code> service which after creating <code>pdfs</code> it stores them or host them on minio.</p><p><strong>Setup Approach:</strong></p><p>The deployment of Minio is orchestrated through the <code>/home/samarth-devops/docker-compose/minio-compose.yml</code> file. After this service is up and running, a series of commands using the <code>minio-client</code> (<code>mc</code>) utility is performed to create and manage buckets, configure permissions, and ensure optimal operation.</p><p>Minio-client has alredy been downloaded on this server. But you can download it from <a href="https://min.io/docs/minio/linux/reference/minio-mc.html#install-mc" target="_blank" rel="noopener noreferrer">here</a>.</p><p>Next we just need to run few commands.</p><ol><li><p>Create an alias</p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">mc alias set &lt;aliasname&gt; &lt;endpoint&gt; &lt;access_key&gt; &lt;secret key&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>Create bucket</p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">mc mb &lt;aliasname&gt;/doc-generator</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>Create bucket policy</p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">mc admin policy create &lt;aliasname&gt; doc-generator /home/samarth-devops/docker-compose/minio-policies/doc-generator.json</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>Make bucket public so that it can be accessed anonymously</p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">mc anonymous set download &lt;aliasname&gt;/doc-generator</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>Restart this service</p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">docker-compose -f minio-compose.yml restart</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li></ol><h5 class="anchor anchorWithStickyNavbar_LWe7" id="sentry"><a href="https://sentry.io" target="_blank" rel="noopener noreferrer">Sentry</a><a href="#sentry" class="hash-link" aria-label="Direct link to sentry" title="Direct link to sentry">​</a></h5><p>Sentry stands as a powerful tool for keeping an eye on how well an application performs and for tracking any errors that might pop up.</p><p>We make use of Sentry to monitor the <code>eSamwad</code> application, making sure it runs smoothly.</p><p><strong>Setup Approach:</strong></p><p>Getting Sentry up and running is quite straightforward. Just follow these steps:</p><ol><li><p>Begin by cloning the repository and navigating into it.</p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">git clone https://github.com/getsentry/self-hosted.git</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>Modify the <code>.env</code> file to match your configuration needs.</p></li><li><p>Start the service by using <code>docker-compose</code>.</p><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">docker-compose up -d</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li></ol><p>This will get Sentry running and ready to help keep an eye on your application&#x27;s performance and errors.</p><h5 class="anchor anchorWithStickyNavbar_LWe7" id="posthog"><a href="https://posthog.com/" target="_blank" rel="noopener noreferrer">Posthog</a><a href="#posthog" class="hash-link" aria-label="Direct link to posthog" title="Direct link to posthog">​</a></h5><p>PostHog offers a suite of tools designed to analyze the performance of products within modern enterprises. Notably, it sets itself apart by being open source and encompassing a comprehensive array of functionalities crucial for ensuring a product&#x27;s success.</p><p>Within the context of <code>Samarth</code>, we utilize Posthog to gather analytical insights derived from the <code>eSamwad</code> application.</p><p><strong>Setup Approach:</strong></p><p>Setting up Posthog is a breeze, enabling you to get it operational within mere minutes.</p><p>For comprehensive setup instructions, please refer to the following link: <a href="https://github.com/Samagra-Development/posthog-deploy#setup" target="_blank" rel="noopener noreferrer">https://github.com/Samagra-Development/posthog-deploy#setup</a></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="db1-server-">db1 Server 💾<a href="#db1-server-" class="hash-link" aria-label="Direct link to db1 Server 💾" title="Direct link to db1 Server 💾">​</a></h3><p><img loading="lazy" alt="Db1 Server visualized" src="/docs/assets/images/samarth-deployment-db1.drawio-f94f0e7725575c813100246c187f716c.png" width="531" height="191" class="img_ev3q"></p><p>The <strong>db1</strong> server takes on the responsibility of housing the persistence layer for the <code>eSamwad backend</code>. Importantly, access to this server is restricted to its private IP.</p><p>It encompasses the following services:</p><ol><li><p>RabbitMQ</p><p>It functions as the backend for the <strong>celery</strong> app, which manages asynchronous tasks within the <code>eSamwad backend</code>.</p></li><li><p>Postgres</p><p>Postgres we use store <code>eSamwad backend</code> data.</p></li><li><p>Redis</p><p>It is deployed for the purpose of caching, contributing to optimized performance within the system.</p></li></ol><p>All of these have been deployed using <code>/home/samarth-devops/docker-compose/db-compose-esamwad.yml</code>.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="db2-server-">db2 Server 💾<a href="#db2-server-" class="hash-link" aria-label="Direct link to db2 Server 💾" title="Direct link to db2 Server 💾">​</a></h3><p><img loading="lazy" alt="Db2 Server visualized" src="/docs/assets/images/samarth-deployment-db2.drawio-d8e939d99280a16b103f8da6c0c138e7.png" width="841" height="521" class="img_ev3q"></p><p>The <strong>db2</strong> server plays host to the persistence layer of the cross-cutting services. Like the db1 server, access to db2 is confined to its private IP.</p><ol><li><p>ODK-adapter</p><ul><li>Postgres</li><li>Redis</li></ul></li><li><p>Doc-generator</p><ul><li>Postgres</li><li>RabbitMQ</li></ul></li><li><p>Templater</p><ul><li>Postgres</li></ul></li><li><p>Yaus</p><ul><li>Postgres</li><li>RabbitMQ</li><li>Redis</li></ul></li><li><p>ODK-aggregate</p><ul><li>Postgres</li></ul></li><li><p>FusionAuth</p><ul><li>Postgres</li><li>Elastic Search</li></ul></li><li><p>Airflow</p><ul><li>Postgres</li><li>Redis</li></ul></li></ol><p>All these service&#x27;s persistence layer has been deployed using <code>/home/samarth-devops/docker-compose/db-compose.yml</code>.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="swarm-master-server-">swarm-master Server 🧑‍💼<a href="#swarm-master-server-" class="hash-link" aria-label="Direct link to swarm-master Server 🧑‍💼" title="Direct link to swarm-master Server 🧑‍💼">​</a></h3><p><img loading="lazy" alt="Swarm visualized" src="/docs/assets/images/samarth-deployment-swarm.drawio-c321465807f6e9686d30699a618a8a4a.png" width="541" height="381" class="img_ev3q"></p><p>The <strong>swarm-master</strong> server serves as the core hub for our Docker swarm deployment, acting as the central orchestrator for all deployment processes.</p><p>This server operates alongside two subordinate nodes:</p><ol><li><strong>swarm-node2</strong></li><li><strong>swarm-node3</strong></li></ol><p>Upon the successful build and deployment of an application via <code>Jenkins</code>, the result is pushed to the <strong>swarm-master</strong> server. Subsequently, this central server initiates an intricate deployment process across the swarm, making strategic decisions based on factors such as processing capacity and available memory.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="swarm-node2-">swarm-node2 🧑‍🏭<a href="#swarm-node2-" class="hash-link" aria-label="Direct link to swarm-node2 🧑‍🏭" title="Direct link to swarm-node2 🧑‍🏭">​</a></h3><p>The <strong>swarm-node2</strong> node functions as a dedicated worker within the <strong>swarm-master</strong> architecture. It plays a crucial role in collectively contributing to the distributed application deployment process orchestrated by the <strong>swarm-master</strong> server.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="swarm-node3-">swarm-node3 🧑‍🏭<a href="#swarm-node3-" class="hash-link" aria-label="Direct link to swarm-node3 🧑‍🏭" title="Direct link to swarm-node3 🧑‍🏭">​</a></h3><p>Similarly, the <strong>swarm-node3</strong> node serves as another dedicated worker within the <strong>swarm-master</strong> architecture. Just like <strong>swarm-node2</strong>, it actively participates in the collective deployment efforts led by the <strong>swarm-master</strong> server.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/Samarth-HP/docs/tree/master/docs/tech/deployment/current-infra.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/tech/deployment/"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Deployment</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/tech/deployment/db-setup"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">DB Setup</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#request-flow" class="table-of-contents__link toc-highlight">Request Flow</a></li><li><a href="#server-breakdown" class="table-of-contents__link toc-highlight">Server Breakdown</a><ul><li><a href="#application-server-" class="table-of-contents__link toc-highlight">Application Server 📱</a></li><li><a href="#db1-server-" class="table-of-contents__link toc-highlight">db1 Server 💾</a></li><li><a href="#db2-server-" class="table-of-contents__link toc-highlight">db2 Server 💾</a></li><li><a href="#swarm-master-server-" class="table-of-contents__link toc-highlight">swarm-master Server 🧑‍💼</a></li><li><a href="#swarm-node2-" class="table-of-contents__link toc-highlight">swarm-node2 🧑‍🏭</a></li><li><a href="#swarm-node3-" class="table-of-contents__link toc-highlight">swarm-node3 🧑‍🏭</a></li></ul></li></ul></div></div></div></div></main></div></div></div>
<script src="/docs/assets/js/runtime~main.9fe122e4.js"></script>
<script src="/docs/assets/js/main.1a4f36c3.js"></script>
</body>
</html>